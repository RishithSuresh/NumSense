<!DOCTYPE html>
<html lang="en">
<head>
    <title>NumSense - Advanced Number Analysis</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: all 0.3s ease;
        }
        .main-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }
        .card {
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 100%;
            max-width: 1100px;
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        .result {
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 15px;
        }
        .history {
            margin-top: 20px;
            text-align: left;
        }
        .section-divider {
            border: none;
            height: 1px;
            background: linear-gradient(90deg, transparent, #ddd, transparent);
            margin: 30px 0;
        }
        .feature-section {
            margin: 25px 0;
            padding: 20px;
            border-radius: 15px;
            background: rgba(248, 249, 250, 0.5);
            border: 1px solid rgba(0,0,0,0.05);
        }
        .dark-mode {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
            color: #f5f5f5;
        }
        .dark-mode .card {
            background: rgba(30, 30, 30, 0.95);
            color: #f5f5f5;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .dark-mode .feature-section {
            background: rgba(40, 40, 40, 0.5);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .dark-mode .section-divider {
            background: linear-gradient(90deg, transparent, #555, transparent);
        }
        .dark-mode .text-muted {
            color: #cccccc !important;
        }
        .dark-mode ::placeholder {
            color: #aaaaaa !important;
            opacity: 1;
        }
        .dark-mode select.form-select {
            background: #2c2c2c;
            color: #f5f5f5;
            border-color: #555;
        }
        .dark-mode select.form-select option {
            background: #2c2c2c;
            color: #f5f5f5;
        }
        .dark-mode input.form-control {
            background: #2c2c2c;
            color: #f5f5f5;
            border-color: #555;
        }
        .dark-mode input.form-control:focus {
            background: #2c2c2c;
            color: #f5f5f5;
            border-color: #888;
            box-shadow: 0 0 0 0.2rem rgba(130, 138, 145, 0.5);
        }
        .dark-mode input.form-control::placeholder {
            color: #aaaaaa;
            opacity: 1;
        }
        .btn-modern {
            border-radius: 12px;
            font-weight: 500;
            padding: 12px 24px;
            transition: all 0.3s ease;
            border: none;
        }
        .btn-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .number-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-3px);
            background: rgba(255,255,255,0.15);
        }
        .dark-mode .stat-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .dark-mode .stat-card:hover {
            background: rgba(255,255,255,0.1);
        }
        .sequence-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            line-height: 1.8;
            word-wrap: break-word;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .dark-mode .sequence-display {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .sequence-analysis {
            background: rgba(248, 249, 250, 0.8);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
        }
        .dark-mode .sequence-analysis {
            background: rgba(40, 40, 40, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .analysis-item {
            display: inline-block;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            padding: 8px 12px;
            margin: 5px;
            font-size: 0.9rem;
        }
        .dark-mode .analysis-item {
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid rgba(102, 126, 234, 0.4);
            color: #f5f5f5;
        }
        /* Enhanced UI Polish */
        .btn-modern {
            position: relative;
            overflow: hidden;
        }
        .btn-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .btn-modern:hover::before {
            left: 100%;
        }
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .table-responsive {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-weight: 600;
        }
        .table td {
            border-color: rgba(0,0,0,0.1);
            vertical-align: middle;
        }
        .dark-mode .table th {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        .dark-mode .table td {
            border-color: rgba(255,255,255,0.1);
            background: rgba(30, 30, 30, 0.5);
            color: #f5f5f5;
        }
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .feature-section h5 {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .dark-mode .feature-section h5 {
            color: #8fa2ff;
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="card p-5 text-center">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="mb-0">🔢 NumSense</h1>
                <button id="toggleMode" class="btn btn-outline-secondary btn-sm">
                    <i class="fa-solid fa-moon"></i> Dark Mode
                </button>
            </div>
            <p class="text-muted mb-4">Discover the hidden identity of your numbers with advanced mathematical analysis</p>
            <form id="numForm">
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="input-group">
                            <input type="text" class="form-control form-control-lg" id="number" placeholder="Enter a number" required>
                            <button type="button" class="btn btn-outline-secondary" id="randomBtn" title="Random Number">
                                <i class="fa-solid fa-dice"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <select class="form-select form-select-lg" id="choice">
                            <option value="Palindrome">Palindrome</option>
                            <option value="Prime">Prime</option>
                            <option value="Armstrong">Armstrong</option>
                            <option value="Perfect">Perfect</option>
                            <option value="Fibonacci">Fibonacci</option>
                            <option value="Happy">Happy Number</option>
                            <option value="Magic">Magic Number</option>
                            <option value="Triangular">Triangular Number</option>
                            <option value="Square">Perfect Square</option>
                            <option value="Cube">Perfect Cube</option>
                            <option value="Harshad">Harshad Number</option>
                            <option value="Abundant">Abundant Number</option>
                            <option value="Deficient">Deficient Number</option>
                            <option value="Automorphic">Automorphic Number</option>
                            <option value="Kaprekar">Kaprekar Number</option>
                            <option value="Neon">Neon Number</option>
                            <option value="Spy">Spy Number</option>
                            <option value="Duck">Duck Number</option>
                            <option value="Buzz">Buzz Number</option>
                            <option value="Pronic">Pronic Number</option>
                        </select>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col-md-6">
                        <button type="submit" class="btn btn-primary btn-modern w-100">
                            <i class="fa-solid fa-magnifying-glass"></i> Check Number
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button type="button" class="btn btn-success btn-modern w-100" id="checkAllBtn">
                            <i class="fa-solid fa-list-check"></i> Check All Properties
                        </button>
                    </div>
                </div>
            </form>
            <!-- Property Explanation -->
            <div id="propertyExplanation" class="text-muted small mb-3 p-3 rounded" style="background: rgba(108, 117, 125, 0.1);"></div>

            <!-- Result Section -->
            <div id="resultRow" style="display: none;">
                <div class="row justify-content-center">
                    <div class="col-12">
                        <div class="feature-section text-center">
                            <div id="resultBox" class="alert result mb-4 mx-auto" style="font-size: 1.4rem; font-weight: 600; max-width: 600px; padding: 20px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);"></div>
                            <div id="explanationBox" class="mx-auto p-4 rounded" style="background: rgba(108, 117, 125, 0.1); word-break: break-word; max-width: 700px; font-size: 1rem; line-height: 1.6;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- All Properties Table -->
            <div id="allPropsBox"></div>

            <hr class="section-divider">

            <!-- Number Statistics Feature (NEW) -->
            <div class="feature-section">
                <h5 class="mb-3"><i class="fa-solid fa-chart-pie"></i> Number Statistics</h5>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <input type="number" class="form-control" id="statsNumber" placeholder="Enter number for stats" min="1">
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-info btn-modern w-100" id="generateStatsBtn">
                            <i class="fa-solid fa-calculator"></i> Generate Stats
                        </button>
                    </div>
                </div>
                <div id="numberStats" class="number-stats"></div>
            </div>

            <hr class="section-divider">

            <!-- NEW POWERFUL FEATURE: Sequence Generator & Analyzer -->
            <div class="feature-section">
                <h5 class="mb-3"><i class="fa-solid fa-infinity"></i> Sequence Generator & Analyzer</h5>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <select class="form-select" id="sequenceType">
                            <option value="fibonacci">Fibonacci Sequence</option>
                            <option value="prime">Prime Numbers</option>
                            <option value="square">Perfect Squares</option>
                            <option value="cube">Perfect Cubes</option>
                            <option value="triangular">Triangular Numbers</option>
                            <option value="factorial">Factorial Sequence</option>
                            <option value="lucas">Lucas Numbers</option>
                            <option value="catalan">Catalan Numbers</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <input type="number" class="form-control" id="sequenceLimit" placeholder="Generate up to..." min="1" max="1000" value="20">
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-warning btn-modern w-100" id="generateSequenceBtn">
                            <i class="fa-solid fa-magic-wand-sparkles"></i> Generate Sequence
                        </button>
                    </div>
                </div>
                <div id="sequenceResult" class="mt-3"></div>
                <div id="sequenceAnalysis" class="mt-3"></div>
            </div>

            <hr class="section-divider">

            <!-- History Section -->
            <div class="feature-section">
                <h5 class="mb-3"><i class="fa-solid fa-clock-rotate-left"></i> Recent Checks</h5>
                <ul id="historyList" class="list-unstyled"></ul>
            </div>

            <hr class="section-divider">

            <!-- Visualization Section -->
            <div class="feature-section">
                <h5 class="mb-3"><i class="fa-solid fa-chart-column"></i> Visualize Properties in Range</h5>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <input type="number" class="form-control" id="rangeStart" placeholder="Start" min="1" value="1">
                    </div>
                    <div class="col-md-4">
                        <input type="number" class="form-control" id="rangeEnd" placeholder="End" min="1" value="100">
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-info btn-modern w-100" id="visualizeBtn">
                            <i class="fa-solid fa-chart-column"></i> Visualize
                        </button>
                    </div>
                </div>
                <canvas id="propertyChart" height="200"></canvas>
            </div>

            <!-- Footer -->
            <div class="text-center mt-4 pt-3" style="border-top: 1px solid rgba(0,0,0,0.1);">
                <p class="text-muted small mb-0">
                    <i class="fa-solid fa-heart" style="color: #e74c3c;"></i>
                    Made with passion for mathematics •
                    <i class="fa-solid fa-infinity"></i>
                    Explore the beauty of numbers
                </p>
            </div>
        </div>
    </div>

    <!-- Confetti JS -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Bootstrap + JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const form = document.getElementById("numForm");
        const resultBox = document.getElementById("resultBox");
        const historyList = document.getElementById("historyList");
        let history = [];

        form.addEventListener("submit", function(e) {
            e.preventDefault();

            const number = document.getElementById("number").value;
            const choice = document.getElementById("choice").value;

            // Hide old result row
            document.getElementById("resultRow").style.display = "none";
            let result = "";
            let isPositive = false;
            let explanation = "";
            if (choice === "Palindrome") {
                isPositive = number === number.split("").reverse().join("");
                result = isPositive ? `${number} is a Palindrome ✅` : `${number} is not a Palindrome ❌`;
                explanation = `Reverse of ${number} is ${number.split("").reverse().join("")}.`;
            } else if (choice === "Prime") {
                let n = parseInt(number);
                if (n < 2) {
                    isPositive = false;
                    explanation = `${number} is less than 2.`;
                } else {
                    let divisor = null;
                    for (let i = 2; i <= Math.floor(Math.sqrt(n)); i++) {
                        if (n % i === 0) { divisor = i; break; }
                    }
                    isPositive = divisor === null;
                    explanation = isPositive ? `No divisors found between 2 and ${Math.floor(Math.sqrt(n))}.` : `Divisible by ${divisor}.`;
                }
                result = isPositive ? `${number} is Prime ✅` : `${number} is not Prime ❌`;
            } else if (choice === "Armstrong") {
                let power = number.length;
                let parts = number.split("").map(d => `${d}^${power}=${Math.pow(parseInt(d), power)}`);
                let sum = number.split("").reduce((acc, d) => acc + Math.pow(parseInt(d), power), 0);
                isPositive = sum == number;
                explanation = `${parts.join(' + ')} = ${sum}`;
                result = isPositive ? `${number} is an Armstrong Number ✅` : `${number} is not an Armstrong Number ❌`;
            } else if (choice === "Perfect") {
                let n = parseInt(number);
                let divisors = [];
                for (let i = 1; i < n; i++) if (n % i === 0) divisors.push(i);
                let sum = divisors.reduce((a, b) => a + b, 0);
                isPositive = sum === n;
                explanation = `Divisors: [${divisors.join(', ')}]. Sum = ${sum}`;
                result = isPositive ? `${number} is a Perfect Number ✅` : `${number} is not a Perfect Number ❌`;
            } else if (choice === "Fibonacci") {
                let n = parseInt(number);
                let a = 0, b = 1;
                let seq = [0, 1];
                while (b < n) { a = b; b = a + b; seq.push(b); }
                isPositive = (a === n || b === n);
                explanation = `Fibonacci sequence up to ${number}: [${seq.filter(x => x <= n).join(', ')}]`;
                result = isPositive ? `${number} is a Fibonacci Number ✅` : `${number} is not a Fibonacci Number ❌`;
            } else if (choice === "Happy") {
                let n = parseInt(number);
                let seen = new Set();
                let current = n;
                while (current !== 1 && !seen.has(current)) {
                    seen.add(current);
                    current = current.toString().split('').reduce((sum, digit) => sum + Math.pow(parseInt(digit), 2), 0);
                }
                isPositive = current === 1;
                explanation = `Process: ${n} → ${Array.from(seen).join(' → ')} → ${current}`;
                result = isPositive ? `${number} is a Happy Number ✅` : `${number} is not a Happy Number ❌`;
            } else if (choice === "Magic") {
                let n = parseInt(number);
                let current = n;
                while (current >= 10) {
                    current = current.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
                }
                isPositive = current === 1;
                explanation = `Sum of digits repeatedly until single digit: ${current}`;
                result = isPositive ? `${number} is a Magic Number ✅` : `${number} is not a Magic Number ❌`;
            } else if (choice === "Triangular") {
                let n = parseInt(number);
                let k = Math.floor((-1 + Math.sqrt(1 + 8 * n)) / 2);
                isPositive = k * (k + 1) / 2 === n;
                explanation = `Formula: k(k+1)/2 where k=${k}, result=${k * (k + 1) / 2}`;
                result = isPositive ? `${number} is a Triangular Number ✅` : `${number} is not a Triangular Number ❌`;
            } else if (choice === "Square") {
                let n = parseInt(number);
                let sqrt = Math.sqrt(n);
                isPositive = Number.isInteger(sqrt);
                explanation = `Square root of ${n} is ${sqrt}`;
                result = isPositive ? `${number} is a Perfect Square ✅` : `${number} is not a Perfect Square ❌`;
            } else if (choice === "Cube") {
                let n = parseInt(number);
                let cbrt = Math.round(Math.cbrt(n));
                isPositive = cbrt * cbrt * cbrt === n;
                explanation = `Cube root of ${n} is approximately ${Math.cbrt(n).toFixed(2)}, ${cbrt}³ = ${cbrt * cbrt * cbrt}`;
                result = isPositive ? `${number} is a Perfect Cube ✅` : `${number} is not a Perfect Cube ❌`;
            } else if (choice === "Harshad") {
                let n = parseInt(number);
                let digitSum = number.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
                isPositive = n % digitSum === 0;
                explanation = `Sum of digits: ${digitSum}, ${n} ÷ ${digitSum} = ${(n / digitSum).toFixed(2)}`;
                result = isPositive ? `${number} is a Harshad Number ✅` : `${number} is not a Harshad Number ❌`;
            } else if (choice === "Abundant") {
                let n = parseInt(number);
                let divisors = [];
                for (let i = 1; i < n; i++) if (n % i === 0) divisors.push(i);
                let sum = divisors.reduce((a, b) => a + b, 0);
                isPositive = sum > n;
                explanation = `Proper divisors: [${divisors.join(', ')}]. Sum = ${sum}`;
                result = isPositive ? `${number} is an Abundant Number ✅` : `${number} is not an Abundant Number ❌`;
            } else if (choice === "Deficient") {
                let n = parseInt(number);
                let divisors = [];
                for (let i = 1; i < n; i++) if (n % i === 0) divisors.push(i);
                let sum = divisors.reduce((a, b) => a + b, 0);
                isPositive = sum < n;
                explanation = `Proper divisors: [${divisors.join(', ')}]. Sum = ${sum}`;
                result = isPositive ? `${number} is a Deficient Number ✅` : `${number} is not a Deficient Number ❌`;
            } else if (choice === "Automorphic") {
                let n = parseInt(number);
                let square = n * n;
                let nStr = n.toString();
                let squareStr = square.toString();
                isPositive = squareStr.endsWith(nStr);
                explanation = `${n}² = ${square}, ends with ${nStr}`;
                result = isPositive ? `${number} is an Automorphic Number ✅` : `${number} is not an Automorphic Number ❌`;
            } else if (choice === "Kaprekar") {
                let n = parseInt(number);
                let square = n * n;
                let squareStr = square.toString();
                let len = n.toString().length;
                if (squareStr.length === 1) {
                    isPositive = n === 1;
                } else {
                    let left = squareStr.slice(0, -len) || '0';
                    let right = squareStr.slice(-len);
                    isPositive = parseInt(left) + parseInt(right) === n;
                }
                explanation = `${n}² = ${square}, split and add parts`;
                result = isPositive ? `${number} is a Kaprekar Number ✅` : `${number} is not a Kaprekar Number ❌`;
            } else if (choice === "Neon") {
                let n = parseInt(number);
                let square = n * n;
                let digitSum = square.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
                isPositive = digitSum === n;
                explanation = `${n}² = ${square}, sum of digits = ${digitSum}`;
                result = isPositive ? `${number} is a Neon Number ✅` : `${number} is not a Neon Number ❌`;
            } else if (choice === "Spy") {
                let digits = number.toString().split('').map(d => parseInt(d));
                let sum = digits.reduce((a, b) => a + b, 0);
                let product = digits.reduce((a, b) => a * b, 1);
                isPositive = sum === product;
                explanation = `Sum: ${sum}, Product: ${product}`;
                result = isPositive ? `${number} is a Spy Number ✅` : `${number} is not a Spy Number ❌`;
            } else if (choice === "Duck") {
                let nStr = number.toString();
                isPositive = nStr.includes('0') && !nStr.startsWith('0');
                explanation = `Contains zero but doesn't start with zero`;
                result = isPositive ? `${number} is a Duck Number ✅` : `${number} is not a Duck Number ❌`;
            } else if (choice === "Buzz") {
                let n = parseInt(number);
                isPositive = n % 7 === 0 || n.toString().includes('7');
                explanation = `Divisible by 7: ${n % 7 === 0}, Contains 7: ${n.toString().includes('7')}`;
                result = isPositive ? `${number} is a Buzz Number ✅` : `${number} is not a Buzz Number ❌`;
            } else if (choice === "Pronic") {
                let n = parseInt(number);
                let k = Math.floor(Math.sqrt(n));
                isPositive = k * (k + 1) === n;
                explanation = `${k} × ${k + 1} = ${k * (k + 1)}`;
                result = isPositive ? `${number} is a Pronic Number ✅` : `${number} is not a Pronic Number ❌`;
            }
            // Smooth reveal animation
            document.getElementById("resultRow").style.display = "block";
            document.getElementById("resultRow").style.opacity = "0";
            document.getElementById("resultRow").style.transform = "translateY(20px)";

            setTimeout(() => {
                document.getElementById("resultBox").textContent = result;
                document.getElementById("explanationBox").textContent = explanation;
                resultBox.className = "alert result mb-4 mx-auto animate__animated " +
                                      (isPositive ? "alert-success animate__bounceIn" : "alert-danger animate__shakeX");

                document.getElementById("resultRow").style.transition = "all 0.5s ease";
                document.getElementById("resultRow").style.opacity = "1";
                document.getElementById("resultRow").style.transform = "translateY(0)";
            }, 100);
            if (isPositive) {
                const confettiColors = document.body.classList.contains("dark-mode") 
                    ? ['#FFD700', '#FF69B4', '#00FFFF', '#ADFF2F', '#FF4500']
                    : ['#4facfe', '#00f2fe', '#ff7f50', '#32cd32', '#ff1493'];
                confetti({
                    particleCount: 80,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: confettiColors
                });
            }
            history.unshift(result);
            if (history.length > 5) history.pop();
            historyList.innerHTML = history.map(item => `
                <li class="d-flex align-items-center mb-2 p-2 rounded" style="background: rgba(108, 117, 125, 0.1);">
                    <i class="fa-solid fa-clock me-2" style="color: #667eea;"></i>
                    <span class="small">${item}</span>
                </li>
            `).join("");
        });

        const toggleMode = document.getElementById("toggleMode");

        function updateToggleButton() {
            if (document.body.classList.contains("dark-mode")) {
                toggleMode.innerHTML = '<i class="fa-solid fa-sun"></i> Light Mode';
            } else {
                toggleMode.innerHTML = '<i class="fa-solid fa-moon"></i> Dark Mode';
            }
        }

        // Load saved mode
        if (localStorage.getItem("darkMode") === "true") {
            document.body.classList.add("dark-mode");
        }
        updateToggleButton();

        toggleMode.addEventListener("click", () => {
            document.body.classList.toggle("dark-mode");
            localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
            updateToggleButton();
        });

        // --- Check All Properties Feature ---
        document.getElementById("checkAllBtn").addEventListener("click", function() {
            const number = document.getElementById("number").value;
            if (!number || isNaN(number)) {
                document.getElementById("allPropsBox").innerHTML = '<div class="alert alert-danger">Please enter a valid number.</div>';
                return;
            }

            // Show loading state
            const btn = this;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="loading-spinner"></span> Analyzing...';
            btn.disabled = true;

            // Use setTimeout to allow UI to update
            setTimeout(() => {
            const n = parseInt(number);

            // Helper function to check number properties
            function checkProperty(type) {
                switch(type) {
                    case 'Palindrome':
                        return number === number.split("").reverse().join("");
                    case 'Prime':
                        return n > 1 && Array.from({length: Math.floor(Math.sqrt(n))-1}, (_, i) => i+2).every(x => n % x !== 0);
                    case 'Armstrong':
                        const armSum = number.split("").reduce((acc, d) => acc + Math.pow(parseInt(d), number.length), 0);
                        return armSum == number;
                    case 'Perfect':
                        let sum = 0;
                        for (let i = 1; i < n; i++) if (n % i === 0) sum += i;
                        return sum === n;
                    case 'Fibonacci':
                        let a = 0, b = 1;
                        while (a < n) [a, b] = [b, a + b];
                        return a === n;
                    case 'Happy':
                        let seen = new Set();
                        let current = n;
                        while (current !== 1 && !seen.has(current)) {
                            seen.add(current);
                            current = current.toString().split('').reduce((sum, digit) => sum + Math.pow(parseInt(digit), 2), 0);
                        }
                        return current === 1;
                    case 'Magic':
                        let temp = n;
                        while (temp >= 10) {
                            temp = temp.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
                        }
                        return temp === 1;
                    case 'Triangular':
                        const k = Math.floor((-1 + Math.sqrt(1 + 8 * n)) / 2);
                        return k * (k + 1) / 2 === n;
                    case 'Square':
                        return Number.isInteger(Math.sqrt(n));
                    case 'Cube':
                        const cbrt = Math.round(Math.cbrt(n));
                        return cbrt * cbrt * cbrt === n;
                    case 'Harshad':
                        const digitSum = number.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
                        return n % digitSum === 0;
                    case 'Abundant':
                        let divSum = 0;
                        for (let i = 1; i < n; i++) if (n % i === 0) divSum += i;
                        return divSum > n;
                    case 'Deficient':
                        let defSum = 0;
                        for (let i = 1; i < n; i++) if (n % i === 0) defSum += i;
                        return defSum < n;
                    case 'Automorphic':
                        const square = n * n;
                        return square.toString().endsWith(n.toString());
                    case 'Kaprekar':
                        const sq = n * n;
                        const sqStr = sq.toString();
                        const len = n.toString().length;
                        if (sqStr.length === 1) return n === 1;
                        const left = sqStr.slice(0, -len) || '0';
                        const right = sqStr.slice(-len);
                        return parseInt(left) + parseInt(right) === n;
                    case 'Neon':
                        const neonSq = n * n;
                        const neonSum = neonSq.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
                        return neonSum === n;
                    case 'Spy':
                        const digits = number.toString().split('').map(d => parseInt(d));
                        const spySum = digits.reduce((a, b) => a + b, 0);
                        const spyProduct = digits.reduce((a, b) => a * b, 1);
                        return spySum === spyProduct;
                    case 'Duck':
                        const nStr = number.toString();
                        return nStr.includes('0') && !nStr.startsWith('0');
                    case 'Buzz':
                        return n % 7 === 0 || n.toString().includes('7');
                    case 'Pronic':
                        const pronicK = Math.floor(Math.sqrt(n));
                        return pronicK * (pronicK + 1) === n;
                    default:
                        return false;
                }
            }

            const properties = ['Palindrome', 'Prime', 'Armstrong', 'Perfect', 'Fibonacci', 'Happy', 'Magic', 'Triangular', 'Square', 'Cube', 'Harshad', 'Abundant', 'Deficient', 'Automorphic', 'Kaprekar', 'Neon', 'Spy', 'Duck', 'Buzz', 'Pronic'];
            // Generate table with all properties
            const rows = properties.map(prop => {
                const result = checkProperty(prop);
                return `<tr><td>${prop}</td><td>${result ? '✅' : '❌'}</td></tr>`;
            }).join("");

            document.getElementById("allPropsBox").innerHTML = `
                <div class="feature-section">
                    <h5 class="mb-3"><i class="fa-solid fa-list-check"></i> All Number Properties</h5>
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead class="table-dark">
                                <tr><th>Property</th><th>Result</th></tr>
                            </thead>
                            <tbody>${rows}</tbody>
                        </table>
                    </div>
                </div>
            `;

            // Restore button state
            btn.innerHTML = originalText;
            btn.disabled = false;
            }, 100);
        });

        // --- Random Number Generator ---
        document.getElementById("randomBtn").addEventListener("click", function() {
            // Generate a random integer between 1 and 99999
            const rand = Math.floor(Math.random() * 99999) + 1;
            document.getElementById("number").value = rand;
        });

        // --- NEW FEATURE: Number Statistics ---
        document.getElementById("generateStatsBtn").addEventListener("click", function() {
            const number = document.getElementById("statsNumber").value;
            if (!number || isNaN(number) || parseInt(number) < 1) {
                document.getElementById("numberStats").innerHTML = '<div class="alert alert-danger">Please enter a valid positive number.</div>';
                return;
            }

            const n = parseInt(number);
            const digits = number.toString().split('').map(d => parseInt(d));

            // Calculate various statistics
            const digitSum = digits.reduce((a, b) => a + b, 0);
            const digitProduct = digits.reduce((a, b) => a * b, 1);
            const digitCount = digits.length;
            const uniqueDigits = [...new Set(digits)].length;
            const maxDigit = Math.max(...digits);
            const minDigit = Math.min(...digits);
            const isEven = n % 2 === 0;
            const digitAverage = (digitSum / digitCount).toFixed(2);

            // Count divisors
            let divisorCount = 0;
            for (let i = 1; i <= n; i++) {
                if (n % i === 0) divisorCount++;
            }

            // Binary representation
            const binary = n.toString(2);

            // Additional statistics (4 new ones)
            const octal = n.toString(8);
            const hexadecimal = n.toString(16).toUpperCase();
            const digitRange = maxDigit - minDigit;
            const digitVariance = (digits.reduce((sum, digit) => sum + Math.pow(digit - (digitSum / digitCount), 2), 0) / digitCount).toFixed(2);

            const stats = [
                { label: 'Digit Sum', value: digitSum, icon: 'fa-plus' },
                { label: 'Digit Product', value: digitProduct, icon: 'fa-xmark' },
                { label: 'Digit Count', value: digitCount, icon: 'fa-hashtag' },
                { label: 'Unique Digits', value: uniqueDigits, icon: 'fa-star' },
                { label: 'Max Digit', value: maxDigit, icon: 'fa-arrow-up' },
                { label: 'Min Digit', value: minDigit, icon: 'fa-arrow-down' },
                { label: 'Even/Odd', value: isEven ? 'Even' : 'Odd', icon: 'fa-balance-scale' },
                { label: 'Digit Average', value: digitAverage, icon: 'fa-chart-line' },
                { label: 'Divisor Count', value: divisorCount, icon: 'fa-divide' },
                { label: 'Binary', value: binary, icon: 'fa-code' },
                { label: 'Octal', value: octal, icon: 'fa-circle-nodes' },
                { label: 'Hexadecimal', value: hexadecimal, icon: 'fa-microchip' },
                { label: 'Digit Range', value: digitRange, icon: 'fa-arrows-left-right' },
                { label: 'Digit Variance', value: digitVariance, icon: 'fa-wave-square' }
            ];

            const statsHTML = stats.map(stat => `
                <div class="stat-card">
                    <i class="fa-solid ${stat.icon} mb-2" style="font-size: 1.2rem; color: #667eea;"></i>
                    <div style="font-size: 0.9rem; color: #666;">${stat.label}</div>
                    <div style="font-size: 1.1rem; font-weight: 600; margin-top: 5px;">${stat.value}</div>
                </div>
            `).join('');

            document.getElementById("numberStats").innerHTML = statsHTML;
        });

        // --- NEW POWERFUL FEATURE: Sequence Generator & Analyzer ---
        document.getElementById("generateSequenceBtn").addEventListener("click", function() {
            const sequenceType = document.getElementById("sequenceType").value;
            const limit = parseInt(document.getElementById("sequenceLimit").value);

            if (!limit || limit < 1 || limit > 1000) {
                document.getElementById("sequenceResult").innerHTML = '<div class="alert alert-danger">Please enter a valid limit (1-1000).</div>';
                return;
            }

            let sequence = [];
            let description = "";
            let formula = "";

            switch(sequenceType) {
                case 'fibonacci':
                    sequence = generateFibonacci(limit);
                    description = "Fibonacci Sequence";
                    formula = "F(n) = F(n-1) + F(n-2), where F(0)=0, F(1)=1";
                    break;
                case 'prime':
                    sequence = generatePrimes(limit);
                    description = "Prime Numbers";
                    formula = "Numbers only divisible by 1 and themselves";
                    break;
                case 'square':
                    sequence = generateSquares(limit);
                    description = "Perfect Squares";
                    formula = "n² for n = 1, 2, 3, ...";
                    break;
                case 'cube':
                    sequence = generateCubes(limit);
                    description = "Perfect Cubes";
                    formula = "n³ for n = 1, 2, 3, ...";
                    break;
                case 'triangular':
                    sequence = generateTriangular(limit);
                    description = "Triangular Numbers";
                    formula = "T(n) = n(n+1)/2";
                    break;
                case 'factorial':
                    sequence = generateFactorial(limit);
                    description = "Factorial Sequence";
                    formula = "n! = n × (n-1) × ... × 2 × 1";
                    break;
                case 'lucas':
                    sequence = generateLucas(limit);
                    description = "Lucas Numbers";
                    formula = "L(n) = L(n-1) + L(n-2), where L(0)=2, L(1)=1";
                    break;
                case 'catalan':
                    sequence = generateCatalan(limit);
                    description = "Catalan Numbers";
                    formula = "C(n) = (2n)! / ((n+1)! × n!)";
                    break;
            }

            // Display sequence
            document.getElementById("sequenceResult").innerHTML = `
                <div class="sequence-display">
                    <h6><i class="fa-solid fa-infinity"></i> ${description}</h6>
                    <p><strong>Formula:</strong> ${formula}</p>
                    <p><strong>First ${sequence.length} terms:</strong></p>
                    <div style="font-size: 1.2rem; font-weight: 600;">${sequence.join(', ')}</div>
                </div>
            `;

            // Analyze sequence
            analyzeSequence(sequence, description);
        });

        // Sequence generation functions
        function generateFibonacci(limit) {
            const seq = [0, 1];
            while (seq.length < limit) {
                seq.push(seq[seq.length - 1] + seq[seq.length - 2]);
            }
            return seq.slice(0, limit);
        }

        function generatePrimes(limit) {
            const primes = [];
            let num = 2;
            while (primes.length < limit) {
                let isPrime = true;
                for (let i = 2; i <= Math.sqrt(num); i++) {
                    if (num % i === 0) {
                        isPrime = false;
                        break;
                    }
                }
                if (isPrime) primes.push(num);
                num++;
            }
            return primes;
        }

        function generateSquares(limit) {
            const squares = [];
            for (let i = 1; squares.length < limit; i++) {
                squares.push(i * i);
            }
            return squares;
        }

        function generateCubes(limit) {
            const cubes = [];
            for (let i = 1; cubes.length < limit; i++) {
                cubes.push(i * i * i);
            }
            return cubes;
        }

        function generateTriangular(limit) {
            const triangular = [];
            for (let i = 1; triangular.length < limit; i++) {
                triangular.push(i * (i + 1) / 2);
            }
            return triangular;
        }

        function generateFactorial(limit) {
            const factorial = [1];
            for (let i = 1; factorial.length < limit; i++) {
                factorial.push(factorial[factorial.length - 1] * i);
            }
            return factorial;
        }

        function generateLucas(limit) {
            const lucas = [2, 1];
            while (lucas.length < limit) {
                lucas.push(lucas[lucas.length - 1] + lucas[lucas.length - 2]);
            }
            return lucas.slice(0, limit);
        }

        function generateCatalan(limit) {
            const catalan = [1];
            for (let n = 1; catalan.length < limit; n++) {
                let cat = 1;
                for (let i = 0; i < n; i++) {
                    cat = cat * (n + i + 1) / (i + 1);
                }
                catalan.push(Math.round(cat / (n + 1)));
            }
            return catalan;
        }

        function analyzeSequence(sequence, description) {
            const sum = sequence.reduce((a, b) => a + b, 0);
            const average = (sum / sequence.length).toFixed(2);
            const max = Math.max(...sequence);
            const min = Math.min(...sequence);
            const range = max - min;

            // Calculate differences between consecutive terms
            const differences = [];
            for (let i = 1; i < sequence.length; i++) {
                differences.push(sequence[i] - sequence[i-1]);
            }

            const growthRate = differences.length > 0 ? (differences[differences.length-1] / differences[0]).toFixed(2) : 'N/A';

            document.getElementById("sequenceAnalysis").innerHTML = `
                <div class="sequence-analysis">
                    <h6><i class="fa-solid fa-chart-line"></i> Sequence Analysis</h6>
                    <div class="analysis-item"><strong>Sum:</strong> ${sum}</div>
                    <div class="analysis-item"><strong>Average:</strong> ${average}</div>
                    <div class="analysis-item"><strong>Min:</strong> ${min}</div>
                    <div class="analysis-item"><strong>Max:</strong> ${max}</div>
                    <div class="analysis-item"><strong>Range:</strong> ${range}</div>
                    <div class="analysis-item"><strong>Growth Rate:</strong> ${growthRate}x</div>
                    <div class="analysis-item"><strong>Terms Count:</strong> ${sequence.length}</div>
                </div>
            `;
        }

        // --- Property Explanations ---
        const propertyExplanation = document.getElementById("propertyExplanation");
        const explanations = {
            Palindrome: "A Palindrome number reads the same backward as forward (e.g., 121, 1331).",
            Prime: "A Prime number is only divisible by 1 and itself (e.g., 2, 3, 5, 7).",
            Armstrong: "An Armstrong number is equal to the sum of its own digits each raised to the power of the number of digits (e.g., 153 = 1³ + 5³ + 3³).",
            Perfect: "A Perfect number is equal to the sum of its proper divisors (e.g., 6 = 1 + 2 + 3).",
            Fibonacci: "A Fibonacci number is a number in the Fibonacci sequence (e.g., 0, 1, 1, 2, 3, 5, 8, ...).",
            Happy: "A Happy number eventually reaches 1 when replaced by the sum of squares of its digits repeatedly (e.g., 7, 10, 13).",
            Magic: "A Magic number becomes 1 when you repeatedly sum its digits until a single digit remains (e.g., 1, 10, 19).",
            Triangular: "A Triangular number can be represented as a triangle of dots (e.g., 1, 3, 6, 10, 15).",
            Square: "A Perfect Square is an integer that is the square of another integer (e.g., 1, 4, 9, 16, 25).",
            Cube: "A Perfect Cube is an integer that is the cube of another integer (e.g., 1, 8, 27, 64, 125).",
            Harshad: "A Harshad number is divisible by the sum of its digits (e.g., 12, 18, 20, 21).",
            Abundant: "An Abundant number has a sum of proper divisors greater than the number itself (e.g., 12, 18, 20).",
            Deficient: "A Deficient number has a sum of proper divisors less than the number itself (e.g., 8, 9, 10, 11).",
            Automorphic: "An Automorphic number appears at the end of its square (e.g., 5² = 25, 25² = 625).",
            Kaprekar: "A Kaprekar number's square can be split into parts that sum to the original number (e.g., 9² = 81, 8+1 = 9).",
            Neon: "A Neon number equals the sum of digits of its square (e.g., 9² = 81, 8+1 = 9).",
            Spy: "A Spy number has equal sum and product of its digits (e.g., 1, 22, 123).",
            Duck: "A Duck number contains the digit 0 but doesn't start with 0 (e.g., 10, 101, 1020).",
            Buzz: "A Buzz number is divisible by 7 or contains the digit 7 (e.g., 7, 14, 17, 21).",
            Pronic: "A Pronic number is the product of two consecutive integers (e.g., 2, 6, 12, 20, 30)."
        };
        function updateExplanation() {
            const val = document.getElementById("choice").value;
            propertyExplanation.textContent = explanations[val] || "";
        }
        document.getElementById("choice").addEventListener("change", updateExplanation);
        updateExplanation();
        // --- Visualization Feature ---
        let chartInstance = null;
        document.getElementById("visualizeBtn").addEventListener("click", function() {
            const start = parseInt(document.getElementById("rangeStart").value);
            const end = parseInt(document.getElementById("rangeEnd").value);
            if (isNaN(start) || isNaN(end) || start < 1 || end < start) {
                alert("Please enter a valid range (start <= end, both > 0)");
                return;
            }
            // Count properties in range
            let counts = {Palindrome:0, Prime:0, Armstrong:0, Perfect:0, Fibonacci:0};
            for (let n = start; n <= end; n++) {
                const s = n.toString();
                // Palindrome
                if (s === s.split("").reverse().join("")) counts.Palindrome++;
                // Prime
                if (n > 1 && Array.from({length: n-2}, (_, i) => i+2).every(x => n % x !== 0)) counts.Prime++;
                // Armstrong
                if (s.split("").reduce((acc, d) => acc + Math.pow(parseInt(d), s.length), 0) == n) counts.Armstrong++;
                // Perfect
                let sum = 0;
                for (let i = 1; i <= n/2; i++) if (n % i === 0) sum += i;
                if (sum === n) counts.Perfect++;
                // Fibonacci
                let a = 0, b = 1;
                while (a < n) [a, b] = [b, a + b];
                if (a === n) counts.Fibonacci++;
            }
            // Draw chart
            const ctx = document.getElementById('propertyChart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(counts),
                    datasets: [{
                        label: `Count in [${start}, ${end}]`,
                        data: Object.values(counts),
                        backgroundColor: [
                            '#4facfe', '#00f2fe', '#ff7f50', '#32cd32', '#ff1493'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: 'Number Properties Distribution' }
                    },
                    scales: {
                        y: { beginAtZero: true, precision:0 }
                    }
                }
            });
        });
    </script>
</body>
</html>
